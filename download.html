<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Download File</title>
</head>
<body>
<h1>Download File</h1>
<form id="downloadForm" action="/download" method="get">
    <input type="text" id="filenameInput" name="filename" placeholder="Enter filename" required>
    <input type="hidden" id="fullFilenameInput" name="fullFilename">
    <button type="submit">Download</button>
</form>
<div id="downloadStatus"></div>

<script>
    document.getElementById('downloadForm').addEventListener('submit', async function(event) {
        event.preventDefault();

        var username = localStorage.getItem('username');
        var filenameInput = document.getElementById('filenameInput');
        var fullFilenameInput = document.getElementById('fullFilenameInput');
        fullFilenameInput.value = username + '/' + filenameInput.value;

        try {
            const response = await fetch(`/download?filename=${filenameInput.value}&fullFilename=${fullFilenameInput.value}`);

            if (!response.ok) {
                throw new Error(`Download failed with status: ${response.status}`);
            }

            const blob = await response.blob();

            const downloadLink = document.createElement('a');
            downloadLink.href = window.URL.createObjectURL(blob);
            downloadLink.download = filenameInput.value;
            downloadLink.click();
            document.getElementById('downloadStatus').innerText = 'Download successful';
        } catch (error) {
            document.getElementById('downloadStatus').innerText = 'File not found or download failed. Please check the filename and try again.';
        }
    });
</script>
</body>
</html>
